<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Wordplay</title>
    <link rel="manifest" href="manifest.json">
    <link rel="stylesheet" href="wordplay.css">
</head>
<body>

    <div id="header">
        <div class="stat-box">
            <div id="score">0</div>
            <div class="stat-label">Score</div>
        </div>
        <div class="stat-box">
            <div id="timer">3:00</div>
            <div class="stat-label">Time</div>
        </div>
        <div class="stat-box">
            <div id="word-remaining">?</div>
            <div class="stat-label">Remaining</div>
        </div>
    </div>

    <div id="game-container">
        <div id="grid">
            <div id="grid-loader">
                <div id="loader-msg">Loading Dictionary...</div>
                <button id="btn-stop-gen" style="display:none">Stop & Play Best</button>
            </div>
        </div>

        <div id="current-word-container">
            <div id="current-word"></div>
        </div>
        <div id="message-area">Initializing...</div>
    </div>

    <div id="controls">
        <button id="btn-rotate" class="secondary" disabled>Rotate</button>
        <button id="btn-pause" disabled>Pause</button>
        <button id="btn-options" disabled>Options</button>
        <button id="btn-finish" disabled>Finish</button>
    </div>

    <div id="list-container">
        <div id="list-title">Found Words</div>
        <div id="found-words-list"></div>
    </div>

    <div id="summary-overlay" class="overlay">
        <div class="modal">
            <h2>Game Over</h2>
            <div id="summary-stats">
                Found <b id="final-found-count">0</b> of <b id="final-total-count">0</b> words.<br>
                Score: <b id="final-score" style="color:var(--found-color)">0</b> / <span id="final-total-score">0</span>
            </div>
            
            <div id="summary-grid-container">
                <div id="summary-grid"></div>
            </div>
            <div style="font-size:0.7rem; opacity:0.7; margin-bottom: 5px;">Tap a word to see its path</div>

            <div id="final-word-list">
                <div style="text-align:center; padding:10px;">Generating results...</div>
            </div>
            <button id="btn-restart">New Game</button>
        </div>
    </div>

    <div id="def-overlay" class="overlay">
        <div class="modal">
            <h2 id="def-title">Word</h2>
            <div id="def-content">Loading...</div>
            <button class="secondary" onclick="document.getElementById('def-overlay').classList.remove('visible')">Close</button>
        </div>
    </div>

    <div id="settings-overlay" class="overlay">
        <div class="modal">
            <h2>Game Options</h2>
            
            <div class="setting-row">
                <span class="setting-label">Min Word Length:</span>
                <input type="number" id="setting-min-len" class="setting-input" value="3" min="2" max="6">
            </div>

            <div class="setting-row">
                <span class="setting-label">Max Words per Board:<br><small>(999 = No Limit)</small></span>
                <input type="number" id="setting-max-words" class="setting-input" value="999" min="1" max="999">
            </div>

            <div class="setting-row">
                <span class="setting-label">Timer Mode:</span>
                <select id="setting-timer-mode" class="setting-input" style="width: auto; padding: 5px 10px;">
                    <option value="countdown">Countdown (3m)</option>
                    <option value="stopwatch">Stopwatch (Count Up)</option>
                </select>
            </div>

            <div style="margin-top:10px; font-size:0.8rem; opacity: 0.7;">
                Settings are saved automatically.
            </div>
            
            <div class="setting-row">
                <span class="setting-label">Haptic Feedback:</span>
                <label class="switch">
                    <input type="checkbox" id="setting-haptics">
                    <span class="slider round"></span>
                </label>
            </div>

            <div style="margin-top:10px;">
                <button id="btn-test-haptic" class="secondary" style="font-size:0.8rem; width:100%;">Test Vibration</button>
            </div>

            <div style="margin-top:20px; border-top: 1px solid var(--list-border); padding-top: 15px;">
                <button id="btn-reset-storage" class="danger" style="width: 100%;">Reset All Game Data</button>
                <div style="font-size:0.7rem; opacity: 0.6; margin-top:5px; text-align: center;">
                    Clears settings, cached dictionary, and saved games.
                </div>
            </div>

            <div style="margin-top:20px; display:flex; gap:10px; justify-content:center;">
                <button id="btn-cancel-settings" class="secondary">Cancel</button>
                <button id="btn-save-settings">Save & Restart</button>
            </div>
        </div>
    </div>

    <script src="wordplay.js"></script>
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('sw.js')
            .then(reg => console.log('Service Worker registered: ', reg))
            .catch(err => console.log('Service Worker registration failed: ', err));
        });
      }
    </script>
</body>
</html>
